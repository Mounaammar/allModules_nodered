const axios = require("axios");

module.exports = function(RED) {
  function LowerCaseNode(config) {
    RED.nodes.createNode(this, config);
    var node = this;
    node.on("input", function(msg) {
      node.status({ fill: "yellow", shape: "dot", text: "Executing ..." });

      axios
        .get("https://myspace-api-malekkamoua.herokuapp.com/")
        .then(function(response) {
          msg.payload = response.data[0].title
          return response;
        })
        .catch(function(error) {
          node.status({ fill: "red", shape: "dot", text: error });
          console.log(error);
        })
        .then(function() {
            setTimeout(function() {
                msg.payload = msg.payload.toLowerCase();
                node.send(msg);
                node.status({ fill: "green", shape: "dot", text: "Done" });

                setTimeout(() => {
                    node.status({});
                  }, 2000);

              }, 8000);
    
        });

    });
  }
  RED.nodes.registerType("lower-case", LowerCaseNode);
};
